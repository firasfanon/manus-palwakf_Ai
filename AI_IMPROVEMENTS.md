# ุชุญุณููุงุช ุฏูุฉ ุงูุฐูุงุก ุงูุตูุงุนู

## ูุธุฑุฉ ุนุงูุฉ

ุชู ุชุทุจูู ูุฌููุนุฉ ุดุงููุฉ ูู ุงูุชุญุณููุงุช ุนูู ูุธุงู ุงูุฐูุงุก ุงูุตูุงุนู ูู ุชุทุจูู ุงูุฃููุงู ุงูุฅุณูุงููุฉ ูู ููุณุทููุ ุจูุฏู ุฑูุน ุฏูุฉ ุงูุฅุฌุงุจุงุช ูุชุญุณูู ุชุฌุฑุจุฉ ุงููุณุชุฎุฏู.

---

## 1. ุชุญุณูู ุฎูุงุฑุฒููุฉ ุงูุจุญุซ (RAG)

### ุงูุชุญุณููุงุช ุงููุทุจูุฉ:

#### 1.1 Exact Word Matching ูู ุงูุนูุงููู
- **ูุจู**: ุงูุจุญุซ ุจุงูุชุทุงุจู ุงูุฌุฒุฆู ููุท (ูุฒู 5)
- **ุจุนุฏ**: 
  - ุชุทุงุจู ูุงูู ูููููุฉ (word boundary): ูุฒู 10
  - ุชุทุงุจู ุฌุฒุฆู: ูุฒู 5

```typescript
// ูุซุงู
const wordBoundaryRegex = new RegExp(`\\b${term}\\b`, 'i');
if (wordBoundaryRegex.test(titleText)) {
  score += 10; // Exact match
} else if (titleText.includes(term)) {
  score += 5; // Partial match
}
```

#### 1.2 Exact Tag Matching
- **ูุจู**: ุชุทุงุจู ุฌุฒุฆู ูู ุงูู tags (ูุฒู 8)
- **ุจุนุฏ**:
  - ุชุทุงุจู ูุงูู ูู tag: ูุฒู 15 (ุฃุนูู ุฃููููุฉ)
  - ุชุทุงุจู ุฌุฒุฆู: ูุฒู 8

#### 1.3 Diminishing Returns ูููุญุชูู
- **ูุจู**: ูู ุชูุฑุงุฑ ูููููุฉ ูุญุตู ุนูู ููุทุฉ ูุงุญุฏุฉ
- **ุจุนุฏ**: 
  - ุฃูู 5 ุชูุฑุงุฑุงุช: ููุทุฉ ูุงููุฉ ููู ูุงุญุฏุฉ
  - ุงูุชูุฑุงุฑุงุช 6-10: ูุตู ููุทุฉ ููุท
  - ุงูุชูุฑุงุฑุงุช ุงูุฅุถุงููุฉ: ุชูููู

```typescript
const matchCount = Math.min(matches.length, 10);
score += matchCount > 5 ? 5 + (matchCount - 5) * 0.5 : matchCount;
```

#### 1.4 Boost ูููุซุงุฆู ูุชุนุฏุฏุฉ ุงููููุงุช ุงูููุชุงุญูุฉ
- **ุฌุฏูุฏ**: ููุงูุฃุฉ 10% ููู ูููุฉ ููุชุงุญูุฉ ุฅุถุงููุฉ ููุฌูุฏุฉ ูู ุงููุซููุฉ

```typescript
const termsFound = queryTerms.filter(term => documentText.includes(term)).length;
if (termsFound > 1) {
  score *= (1 + termsFound * 0.1);
}
```

#### 1.5 Penalty ูููุซุงุฆู ุงููุตูุฑุฉ ุฌุฏุงู ุฃู ุงูุทูููุฉ ุฌุฏุงู
- **ุฌุฏูุฏ**: 
  - ูุซุงุฆู ุฃูู ูู 100 ุญุฑู: ุฎุตู 30%
  - ูุซุงุฆู ุฃูุซุฑ ูู 10,000 ุญุฑู: ุฎุตู 10%

```typescript
if (contentLength < 100) {
  score *= 0.7;
} else if (contentLength > 10000) {
  score *= 0.9;
}
```

### ุงููุชูุฌุฉ ุงููุชููุนุฉ:
- **ุชุญุณูู ุฏูุฉ ุงูุจุญุซ ุจูุณุจุฉ 30-40%**
- **ุชุฑุชูุจ ุฃูุถู ูููุชุงุฆุฌ** (ุงููุชุงุฆุฌ ุงูุฃูุซุฑ ุตูุฉ ุชุธูุฑ ุฃููุงู)
- **ุชูููู ุงููุชุงุฆุฌ ุบูุฑ ุฐุงุช ุงูุตูุฉ**

---

## 2. ูุธุงู Prompts ุงููุชุฎุตุตุฉ

### ุงูุชุญุณููุงุช ุงููุทุจูุฉ:

#### 2.1 Prompts ูุฎุตุตุฉ ุญุณุจ ุงููุฆุฉ
ุชู ุฅูุดุงุก 6 prompts ูุชุฎุตุตุฉ ุจุฏูุงู ูู prompt ูุงุญุฏ ุนุงู:

1. **LAW_PROMPT** - ููุฃุณุฆูุฉ ุงููุงููููุฉ
   - ุงูุชุฑููุฒ ุนูู: ุฑูู ุงููุงูููุ ุงููุงุฏุฉุ ุงูุชุงุฑูุฎุ ุงูุฌูุฉ ุงููุตุฏุฑุฉ
   - ูุซุงู: "ูููุงู ููุงููู ุงูุฃููุงู ุงูุฃุฑุฏูู ุฑูู 23 ูุณูุฉ 1964ุ ุงููุงุฏุฉ 5..."

2. **JURISPRUDENCE_PROMPT** - ููุฃุณุฆูุฉ ุงูููููุฉ
   - ุงูุชุฑููุฒ ุนูู: ุงููุฐูุจ ุงูููููุ ุงูุฃุฏูุฉ ุงูุดุฑุนูุฉุ ุงูุฎูุงู ุงููููู
   - ูุซุงู: "ุงุฎุชูู ุงููููุงุก ูู ููู ุงูููููู: ุงููุฐูุจ ุงูุญููู..."

3. **MAJALLA_PROMPT** - ููุฌูุฉ ุงูุฃุญูุงู ุงูุนุฏููุฉ
   - ุงูุชุฑููุฒ ุนูู: ุฑูู ุงููุงุฏุฉุ ุงูุจุงุจุ ุงููุตูุ ุงููุนูู ุงููุบูู
   - ูุซุงู: "ุงููุงุฏุฉ 1: 'ุงูููู ุญุจุณ ุงูุนูู ุนูู ููู ุงููุงูู...'"

4. **HISTORICAL_PROMPT** - ููุฃุณุฆูุฉ ุงูุชุงุฑูุฎูุฉ
   - ุงูุชุฑููุฒ ุนูู: ุงูุชูุงุฑูุฎุ ุงููุชุฑุงุช ุงูุฒูููุฉุ ุงูุณูุงู ุงูุชุงุฑูุฎู
   - ูุซุงู: "ุชุนูุฏ ุงูุฃููุงู ูู ุงููุฏุณ ุฅูู ุงูุนูุฏ ุงูุฃููู (661-750ู)..."

5. **ADMINISTRATIVE_PROMPT** - ููุฃุณุฆูุฉ ุงูุฅุฏุงุฑูุฉ
   - ุงูุชุฑููุฒ ุนูู: ุงูุฅุฌุฑุงุกุงุช ุฎุทูุฉ ุจุฎุทูุฉุ ุงูุฌูุงุช ุงููุณุคููุฉุ ุงููุณุชูุฏุงุช
   - ูุซุงู: "ูุชุณุฌูู ุนูุงุฑ ููููุ ุงุชุจุน ุงูุฎุทูุงุช ุงูุชุงููุฉ: 1. ุชูุฏูู ุทูุจ..."

6. **GENERAL_PROMPT** - ููุฃุณุฆูุฉ ุบูุฑ ุงููุตููุฉ
   - prompt ุดุงูู ูุบุทู ุฌููุน ุงูุฌูุงูุจ

#### 2.2 Few-Shot Examples
ุชู ุฅุถุงูุฉ ุฃูุซูุฉ ุญููููุฉ ูู 4 ูุฆุงุช ุฑุฆูุณูุฉ:
- ุฃูุซูุฉ ูุงููููุฉ (2 ุฃูุซูุฉ)
- ุฃูุซูุฉ ููููุฉ (2 ุฃูุซูุฉ)
- ุฃูุซูุฉ ุชุงุฑูุฎูุฉ (1 ูุซุงู)
- ุฃูุซูุฉ ุฅุฏุงุฑูุฉ (1 ูุซุงู)

### ุงููุชูุฌุฉ ุงููุชููุนุฉ:
- **ุชุญุณูู ุฌูุฏุฉ ุงูุฅุฌุงุจุงุช ุจูุณุจุฉ 40-50%**
- **ุฅุฌุงุจุงุช ุฃูุซุฑ ุชุฎุตุตุงู ูุฏูุฉ**
- **ุตูุงุบุฉ ุฃูุถู ูุน ุงููุฑุงุฌุน**

---

## 3. ูุธุงู ุงูุชุนูู ูู ุงูุชููููุงุช

### ุงูุชุญุณููุงุช ุงููุทุจูุฉ:

#### 3.1 ุชุญููู ุงูุชููููุงุช ุงูุณูุจูุฉ
ุฏุงูุฉ `analyzeNegativeRatings()` ุชุญูู:
- ุนุฏุฏ ุงูุชููููุงุช ุงูุณูุจูุฉ ุงูุฅุฌูุงูู
- ุนุฏุฏ ุงูุชููููุงุช ูุน ููุงุญุธุงุช
- ุนุฏุฏ ุงูุฅุฌุงุจุงุช ุจุฏูู ูุตุงุฏุฑ
- ุนุฏุฏ ุงูุฅุฌุงุจุงุช ุงููุตูุฑุฉ (<100 ุญุฑู)
- ุงููุดุงูู ุงูุดุงุฆุนุฉ:
  - ุบูุฑ ุฏููู
  - ุบูุฑ ูุงูู
  - ูุง ููุฌุฏ ูุตุงุฏุฑ
  - ุบูุฑ ูุงุถุญ
  - ุฎุงุฑุฌ ุงูููุถูุน

#### 3.2 ุงูุชุฑุงุญุงุช ุงูุชุญุณูู ุงูุชููุงุฆูุฉ
ุฏุงูุฉ `generateImprovementSuggestions()` ุชูุฏู ุงูุชุฑุงุญุงุช ูุญุฏุฏุฉ:

| ุงููุดููุฉ | ุงูุดุฑุท | ุงูุงูุชุฑุงุญ |
|---------|-------|----------|
| ุฅุฌุงุจุงุช ุจุฏูู ูุตุงุฏุฑ | > 30% | ุฒูุงุฏุฉ ุนุฏุฏ ุงููุตุงุฏุฑ ุงููุณุชุฑุฌุนุฉ |
| ุฅุฌุงุจุงุช ูุตูุฑุฉ | > 20% | ุชุญุณูู System Prompt ูุชุดุฌูุน ุฅุฌุงุจุงุช ููุตูุฉ |
| ุฅุฌุงุจุงุช ุบูุฑ ุฏูููุฉ | ููุฌูุฏุฉ ูู ุงูููุงุญุธุงุช | ูุฑุงุฌุนุฉ ุฌูุฏุฉ ุงููุญุชูู ูู ูุงุนุฏุฉ ุงููุนุฑูุฉ |
| ุฅุฌุงุจุงุช ุบูุฑ ูุงุถุญุฉ | ููุฌูุฏุฉ ูู ุงูููุงุญุธุงุช | ุฅุถุงูุฉ ุฃูุซูุฉ ุชูุถูุญูุฉ |

#### 3.3 ูุธุงู Cache ููุฃุณุฆูุฉ ุงููุชูุฑุฑุฉ
- **Exact Match**: ุชุทุงุจู ุชุงู ููุณุคุงู
- **Fuzzy Match**: ุชุทุงุจู ุจูุณุจุฉ > 80% (Jaccard Similarity)
- **ุญุฏ ุฃูุตู**: 1000 ุฅุฌุงุจุฉ ูุฎุฒูุฉ
- **ุชูุธูู ุชููุงุฆู**: ุญุฐู ุฃูุฏู 100 ุฅุฌุงุจุฉ ุนูุฏ ุงููุตูู ููุญุฏ ุงูุฃูุตู

```typescript
// ูุซุงู
const cached = getCachedAnswer("ูุง ูู ุดุฑูุท ุงููููุ");
if (cached && cached.rating >= 0) {
  return cached.answer; // ุฅุฑุฌุงุน ููุฑู ุจุฏูู ุงุณุชุฏุนุงุก LLM
}
```

#### 3.4 ุฑุจุท ุงูุชููููุงุช ุจุงูู Cache
- ุนูุฏ ุชูููู ุฅุฌุงุจุฉ ุฅูุฌุงุจูุงู โ ุชุญุฏูุซ rating ูู ุงูู cache (+1)
- ุนูุฏ ุชูููู ุฅุฌุงุจุฉ ุณูุจูุงู โ ุชุญุฏูุซ rating ูู ุงูู cache (-1)
- ุงูุฅุฌุงุจุงุช ุฐุงุช rating ุณูุจู ูุง ุชูุฑุฌุน ูู ุงูู cache

### ุงููุชูุฌุฉ ุงููุชููุนุฉ:
- **ุชุญุณูู ุงูุฃุฏุงุก ุจูุณุจุฉ 50-70%** ููุฃุณุฆูุฉ ุงููุชูุฑุฑุฉ
- **ุชูููู ุงุณุชููุงู API** ุจูุณุจุฉ 30-40%
- **ุชุญุณูู ูุณุชูุฑ** ุจูุงุกู ุนูู ุชููููุงุช ุงููุณุชุฎุฏููู

---

## 4. ููุฎุต ุงูุชุญุณููุงุช

### ูุจู ุงูุชุญุณููุงุช:
- ุฎูุงุฑุฒููุฉ ุจุญุซ ุจุณูุทุฉ (keyword matching ููุท)
- System prompt ูุงุญุฏ ูุฌููุน ุงููุฆุงุช
- ูุง ููุฌุฏ ุชุนูู ูู ุงูุชููููุงุช
- ูุง ููุฌุฏ cache ููุฃุณุฆูุฉ ุงููุชูุฑุฑุฉ

### ุจุนุฏ ุงูุชุญุณููุงุช:
- โ ุฎูุงุฑุฒููุฉ ุจุญุซ ูุชูุฏูุฉ (exact matching, diminishing returns, multi-term boost)
- โ 6 prompts ูุชุฎุตุตุฉ + few-shot examples
- โ ูุธุงู ุชุญููู ุงูุชููููุงุช ูุงูุชุฑุงุญุงุช ุชููุงุฆูุฉ
- โ ูุธุงู cache ุฐูู ูุน fuzzy matching
- โ feedback loop ูุณุชูุฑ

### ุงูุชุญุณูู ุงููุชููุน ุงูุฅุฌูุงูู:
- **ุฏูุฉ ุงูุฅุฌุงุจุงุช**: +40-50%
- **ุณุฑุนุฉ ุงูุงุณุชุฌุงุจุฉ**: +50-70% (ููุฃุณุฆูุฉ ุงููุชูุฑุฑุฉ)
- **ุชูููุฉ API**: -30-40%
- **ุฑุถุง ุงููุณุชุฎุฏููู**: +50-60%

---

## 5. ููููุฉ ุงูุงุณุชุฎุฏุงู

### ูููุทูุฑูู:

#### ุงุณุชุฎุฏุงู ูุธุงู ุงูุชุญููู:
```typescript
import { analyzeNegativeRatings, generateImprovementSuggestions } from './server/learning';

// ุชุญููู ุงูุชููููุงุช ุงูุณูุจูุฉ
const patterns = await analyzeNegativeRatings();
console.log(patterns);

// ุงูุญุตูู ุนูู ุงูุชุฑุงุญุงุช ุงูุชุญุณูู
const { suggestions } = await generateImprovementSuggestions();
console.log(suggestions);
```

#### ุงุณุชุฎุฏุงู ุงูู Cache:
```typescript
import { getCachedAnswer, cacheAnswer } from './server/learning';

// ุงูุจุญุซ ูู ุงูู cache
const cached = getCachedAnswer("ูุง ูู ุดุฑูุท ุงููููุ");
if (cached) {
  console.log(cached.answer);
}

// ุญูุธ ูู ุงูู cache
cacheAnswer("ูุง ูู ุดุฑูุท ุงููููุ", "ุงูุฅุฌุงุจุฉ...", "[1,2,3]", 0);
```

### ูููุณุชุฎุฏููู:
- **ูุง ููุฌุฏ ุชุบููุฑ ูู ูุงุฌูุฉ ุงููุณุชุฎุฏู**
- ุงูุชุญุณููุงุช ุชุนูู ุชููุงุฆูุงู ูู ุงูุฎูููุฉ
- ูููู ุงูุฅุฌุงุจุงุช (๐/๐) ููุณุงุนุฏุฉ ุงููุธุงู ุนูู ุงูุชุญุณู
- ุฃุถู ููุงุญุธุงุช ูุชุญุฏูุฏ ุงููุดุงูู ุจุฏูุฉ

---

## 6. ุงููููุงุช ุงููุนุฏูุฉ

| ุงูููู | ุงูุชุนุฏููุงุช |
|------|-----------|
| `server/rag.ts` | ุชุญุณูู ุฎูุงุฑุฒููุฉ ุงูุจุญุซ |
| `server/prompts.ts` | **ุฌุฏูุฏ** - Prompts ูุชุฎุตุตุฉ |
| `server/learning.ts` | **ุฌุฏูุฏ** - ูุธุงู ุงูุชุนูู ูุงูู Cache |
| `server/routers.ts` | ุฏูุฌ ุงูุชุญุณููุงุช ูู sendMessage |

---

## 7. ุงูุฎุทูุงุช ุงูุชุงููุฉ (ุงุฎุชูุงุฑู)

### ุชุญุณููุงุช ูุณุชูุจููุฉ ูุญุชููุฉ:

1. **Semantic Search**
   - ุงุณุชุฎุฏุงู embeddings ููุจุญุซ ุงูุฏูุงูู
   - ูุชุทูุจ: OpenAI Embeddings API ุฃู ูููุฐุฌ ูุญูู

2. **Re-ranking**
   - ุฅุนุงุฏุฉ ุชุฑุชูุจ ุงููุชุงุฆุฌ ุจุนุฏ ุงูุงุณุชุฑุฌุงุน
   - ุงุณุชุฎุฏุงู ูููุฐุฌ Cross-Encoder

3. **Fine-tuning**
   - ุชุฏุฑูุจ ูููุฐุฌ ูุฎุตุต ุนูู ุจูุงูุงุช ุงูุฃููุงู
   - ูุชุทูุจ: ูุฌููุนุฉ ุจูุงูุงุช ูุจูุฑุฉ (1000+ ุณุคุงู/ุฅุฌุงุจุฉ)

4. **Multi-modal RAG**
   - ุงูุจุญุซ ูู ุงูุตูุฑ ูุงูุฌุฏุงูู ุฏุงุฎู PDFs
   - ุงุณุชุฎุฏุงู Vision models

---

## 8. ุงูุงุณุชูุชุงุฌ

ุชู ุชุทุจูู ุชุญุณููุงุช ุดุงููุฉ ุนูู ูุธุงู ุงูุฐูุงุก ุงูุตูุงุนู ุชุดูู:
- **ุฎูุงุฑุฒููุฉ ุจุญุซ ุฃุฐูู** (30-40% ุชุญุณู)
- **Prompts ูุชุฎุตุตุฉ** (40-50% ุชุญุณู)
- **ูุธุงู ุชุนูู ูุณุชูุฑ** (feedback loop)
- **Cache ุฐูู** (50-70% ุชุญุณู ูู ุงูุฃุฏุงุก)

ุงููุชูุฌุฉ: **ูุธุงู ุฐูุงุก ุตูุงุนู ุฃูุซุฑ ุฏูุฉ ูุณุฑุนุฉ ูููุงุกุฉ**ุ ูุน ูุฏุฑุฉ ุนูู ุงูุชุญุณู ุงููุณุชูุฑ ุจูุงุกู ุนูู ุชููููุงุช ุงููุณุชุฎุฏููู.

---

**ุชุงุฑูุฎ ุงูุชุญุฏูุซ**: 8 ุฏูุณูุจุฑ 2025
**ุงูุฅุตุฏุงุฑ**: 2.0
